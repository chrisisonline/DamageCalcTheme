function attachValidation(e,t,a){$("."+e).keyup(function(){validate($(this),t,a)})}function validate(e,t,a){e.val(Math.max(t,Math.min(a,~~e.val())))}function getHPDVs(e){return~~e.find(".at .dvs").val()%2*8+~~e.find(".df .dvs").val()%2*4+~~e.find(1===gen?".sl .dvs":".sa .dvs").val()%2*2+~~e.find(".sp .dvs").val()%2}function calcStats(e){for(var t=0;t<STATS.length;t++)calcStat(e,STATS[t])}function calcCurrentHP(e,t,a){var i=Math.ceil(a*t/100);e.find(".current-hp").val(i)}function calcPercentHP(e,t,a){var i=Math.floor(100*a/t);e.find(".percent-hp").val(i)}function autosetWeather(e,t){var a=$("input:radio[name='weather']:checked").val();switch(lastAutoWeather.indexOf(a)===-1&&(lastManualWeather=a,lastAutoWeather[1-t]=""),e){case"Drought":lastAutoWeather[t]="Sun",$("#sun").prop("checked",!0);break;case"Drizzle":lastAutoWeather[t]="Rain",$("#rain").prop("checked",!0);break;case"Sand Stream":lastAutoWeather[t]="Sand",$("#sand").prop("checked",!0);break;case"Snow Warning":lastAutoWeather[t]="Hail",$("#hail").prop("checked",!0);break;case"Desolate Land":lastAutoWeather[t]="Harsh Sunshine",$("#harsh-sunshine").prop("checked",!0);break;case"Primordial Sea":lastAutoWeather[t]="Heavy Rain",$("#heavy-rain").prop("checked",!0);break;case"Delta Stream":lastAutoWeather[t]="Strong Winds",$("#strong-winds").prop("checked",!0);break;default:lastAutoWeather[t]="";var i=""!==lastAutoWeather[1-t]?lastAutoWeather[1-t]:lastManualWeather;$("input:radio[name='weather'][value='"+i+"']").prop("checked",!0)}}function autosetStatus(e,t){var a=$(e+" .status").val();a!==lastAutoStatus[e]&&(lastManualStatus[e]=a),"Flame Orb"===t?(lastAutoStatus[e]="Burned",$(e+" .status").val("Burned"),$(e+" .status").change()):"Toxic Orb"===t?(lastAutoStatus[e]="Badly Poisoned",$(e+" .status").val("Badly Poisoned"),$(e+" .status").change()):(lastAutoStatus[e]="Healthy",a!==lastManualStatus[e]&&($(e+" .status").val(lastManualStatus[e]),$(e+" .status").change()))}function setSelectValueIfValid(e,t,a){e.val(0!==e.children("option[value='"+t+"']").length?t:a)}function Pokemon(e){if("string"==typeof e){this.name=e.substring(0,e.indexOf(" ("));var t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")),a=pokedex[this.name];this.type1=a.t1,this.type2=a.t2&&"undefined"!=typeof a.t2?a.t2:"",this.rawStats=[],this.boosts=[],this.stats=[],this.evs=[];var i=setdex[this.name][t];if(this.level=i.level,this.HPEVs=i.evs&&"undefined"!=typeof i.evs.hp?i.evs.hp:0,gen<3){var r=15;this.maxHP=~~((2*(a.bs.hp+r)+63)*this.level/100)+this.level+10}else if(1===a.bs.hp)this.maxHP=1;else{var s=31;this.maxHP=~~((2*a.bs.hp+s+~~(this.HPEVs/4))*this.level/100)+this.level+10}this.curHP=this.maxHP,this.nature=i.nature;for(var o=0;o<STATS.length;o++){var n=STATS[o];if(this.boosts[n]=0,this.evs[n]=i.evs&&"undefined"!=typeof i.evs[n]?i.evs[n]:0,gen<3){var l=15;this.rawStats[n]=~~((2*(a.bs[n]+l)+63)*this.level/100)+5}else{var c=i.ivs&&"undefined"!=typeof i.ivs[n]?i.ivs[n]:31,h=NATURES[this.nature],d=h[0]===n?1.1:h[1]===n?.9:1;this.rawStats[n]=~~((~~((2*a.bs[n]+c+~~(this.evs[n]/4))*this.level/100)+5)*d)}}this.ability=i.ability&&"undefined"!=typeof i.ability?i.ability:a.ab&&"undefined"!=typeof a.ab?a.ab:"",this.item=i.item&&"undefined"!=typeof i.item&&("Eviolite"===i.item||i.item.indexOf("ite")<0)?i.item:"",this.status="Healthy",this.toxicCounter=0,this.moves=[];for(var o=0;o<4;o++){var p=i.moves[o],m=moves[p]||moves["(No Move)"];this.moves.push($.extend({},m,{name:0===m.bp?"(No Move)":p,bp:m.bp,type:m.type,category:m.category,isCrit:!!m.alwaysCrit,hits:m.isMultiHit?"Skill Link"===this.ability?5:3:m.isTwoHit?2:1}))}this.weight=a.w}else{var t=e.find("input.set-selector").val();t.indexOf("(")===-1?this.name=t:this.name=t.substring(0,t.indexOf(" (")),this.type1=e.find(".type1").val(),this.type2=e.find(".type2").val(),this.level=~~e.find(".level").val(),this.maxHP=~~e.find(".hp .total").text(),this.curHP=~~e.find(".current-hp").val(),this.HPEVs=~~e.find(".hp .evs").val(),this.rawStats=[],this.boosts=[],this.stats=[],this.evs=[];for(var o=0;o<STATS.length;o++)this.rawStats[STATS[o]]=~~e.find("."+STATS[o]+" .total").text(),this.boosts[STATS[o]]=~~e.find("."+STATS[o]+" .boost").val(),this.evs[STATS[o]]=~~e.find("."+STATS[o]+" .evs").val();this.nature=e.find(".nature").val(),this.ability=e.find(".ability").val(),this.item=e.find(".item").val(),this.status=e.find(".status").val(),this.toxicCounter="Badly Poisoned"===this.status?~~e.find(".toxic-counter").val():0,this.moves=[getMoveDetails(e.find(".move1")),getMoveDetails(e.find(".move2")),getMoveDetails(e.find(".move3")),getMoveDetails(e.find(".move4"))],this.weight=+e.find(".weight").val()}}function getMoveDetails(e){var t=e.find("select.move-selector").val(),a=moves[t];return $.extend({},a,{name:t,bp:~~e.find(".move-bp").val(),type:e.find(".move-type").val(),category:e.find(".move-cat").val(),isCrit:e.find(".move-crit").prop("checked"),hits:a.isMultiHit?~~e.find(".move-hits").val():a.isTwoHit?2:1})}function Field(){var e,t,a=$("input:radio[name='format']:checked").val(),i=$("#gravity").prop("checked"),r=[$("#srL").prop("checked"),$("#srR").prop("checked")];2===gen?(t=[$("#gscSpikesL").prop("checked")?1:0,$("#gscSpikesR").prop("checked")?1:0],e=$("input:radio[name='gscWeather']:checked").val()):(e=$("input:radio[name='weather']:checked").val(),t=[~~$("input:radio[name='spikesL']:checked").val(),~~$("input:radio[name='spikesR']:checked").val()]);var s=$("input:checkbox[name='terrain']:checked").val()?$("input:checkbox[name='terrain']:checked").val():"",o=[$("#reflectL").prop("checked"),$("#reflectR").prop("checked")],n=[$("#lightScreenL").prop("checked"),$("#lightScreenR").prop("checked")],l=[$("#foresightL").prop("checked"),$("#foresightR").prop("checked")],c=[$("#helpingHandR").prop("checked"),$("#helpingHandL").prop("checked")],h=[$("#friendGuardL").prop("checked"),$("#friendGuardR").prop("checked")];this.getWeather=function(){return e},this.clearWeather=function(){e=""},this.getSide=function(d){return new Side(a,s,e,i,r[d],t[d],o[d],n[d],l[d],c[d],h[d])}}function Side(e,t,a,i,r,s,o,n,l,c,h){this.format=e,this.terrain=t,this.weather=a,this.isGravity=i,this.isSR=r,this.spikes=s,this.isReflect=o,this.isLightScreen=n,this.isForesight=l,this.isHelpingHand=c,this.isFriendGuard=h}function clearField(){$("#singles-format").prop("checked",!0),$("#clear").prop("checked",!0),$("#gscClear").prop("checked",!0),$("#gravity").prop("checked",!1),$("#srL").prop("checked",!1),$("#srR").prop("checked",!1),$("#spikesL0").prop("checked",!0),$("#spikesR0").prop("checked",!0),$("#gscSpikesL").prop("checked",!1),$("#gscSpikesR").prop("checked",!1),$("#reflectL").prop("checked",!1),$("#reflectR").prop("checked",!1),$("#lightScreenL").prop("checked",!1),$("#lightScreenR").prop("checked",!1),$("#foresightL").prop("checked",!1),$("#foresightR").prop("checked",!1),$("#helpingHandL").prop("checked",!1),$("#helpingHandR").prop("checked",!1),$("#friendGuardL").prop("checked",!1),$("#friendGuardR").prop("checked",!1)}function getSetOptions(){var e=Object.keys(pokedex);e.sort();for(var t=[],a=0;a<e.length;a++){var i=e[a];if(t.push({pokemon:i,text:i}),i in setdex)for(var r=Object.keys(setdex[i]),s=0;s<r.length;s++){var o=r[s];t.push({pokemon:i,set:o,text:i+" ("+o+")",id:i+" ("+o+")"})}t.push({pokemon:i,set:"Blank Set",text:i+" (Blank Set)",id:i+" (Blank Set)"})}return t}function getSelectOptions(e,t){t&&e.sort();for(var a="",i=0;i<e.length;i++)a+='<option value="'+e[i]+'">'+e[i]+"</option>";return a}function getTerrainEffects(){var e=$(this).prop("className");switch(e=e.substring(0,e.indexOf(" "))){case"type1":case"type2":case"ability":case"item":var t=$(this).closest(".poke-info").prop("id"),a=$("input:checkbox[name='terrain']:checked").val();"Electric"===a?$("#"+t).find("[value='Asleep']").prop("disabled",isGrounded($("#"+t))):"Misty"===a&&$("#"+t).find(".status").prop("disabled",isGrounded($("#"+t)));break;default:$("input:checkbox[name='terrain']").not(this).prop("checked",!1),$(this).prop("checked")&&"Electric"===$(this).val()?($("#p1").find("[value='Asleep']").prop("disabled",isGrounded($("#p1"))),$("#p2").find("[value='Asleep']").prop("disabled",isGrounded($("#p2")))):$(this).prop("checked")&&"Misty"===$(this).val()?($("#p1").find(".status").prop("disabled",isGrounded($("#p1"))),$("#p2").find(".status").prop("disabled",isGrounded($("#p2")))):($("#p1").find("[value='Asleep']").prop("disabled",!1),$("#p1").find(".status").prop("disabled",!1),$("#p2").find("[value='Asleep']").prop("disabled",!1),$("#p2").find(".status").prop("disabled",!1))}}function calculate(){var e=new Pokemon($("#p1")),t=new Pokemon($("#p2")),a=new Field;damageResults=calculateAllMoves(e,t,a);for(var i,r,s,o,n,l,c=-1,h=0;h<4;h++)i=damageResults[0][h],r=i.damage[0]*e.moves[h].hits,s=i.damage[i.damage.length-1]*e.moves[h].hits,o="%"===notation?Math.floor(1e3*r/t.maxHP)/10:Math.floor(48*r/t.maxHP),n="%"===notation?Math.floor(1e3*s/t.maxHP)/10:Math.floor(48*s/t.maxHP),i.damageText=r+"-"+s+" ("+o+" - "+n+notation+")",i.koChanceText=0===e.moves[h].bp?"nice move":getKOChanceText(i.damage,t,a.getSide(1),e.moves[h].hits,"Bad Dreams"===e.ability),$(resultLocations[0][h].move+" + label").text(e.moves[h].name.replace("Hidden Power","HP")),$(resultLocations[0][h].damage).text(o+" - "+n+notation),s>c&&(c=s,l=$(resultLocations[0][h].move)),i=damageResults[1][h],r=i.damage[0]*t.moves[h].hits,s=i.damage[i.damage.length-1]*t.moves[h].hits,o="%"===notation?Math.floor(1e3*r/e.maxHP)/10:Math.floor(48*r/e.maxHP),n="%"===notation?Math.floor(1e3*s/e.maxHP)/10:Math.floor(48*s/e.maxHP),i.damageText=r+"-"+s+" ("+o+" - "+n+notation+")",i.koChanceText=0===t.moves[h].bp?"nice move":getKOChanceText(i.damage,e,a.getSide(0),t.moves[h].hits,"Bad Dreams"===t.ability),$(resultLocations[1][h].move+" + label").text(t.moves[h].name.replace("Hidden Power","HP")),$(resultLocations[1][h].damage).text(o+" - "+n+notation),s>c&&(c=s,l=$(resultLocations[1][h].move));l.prop("checked",!0),l.change(),$("#resultHeaderL").text(e.name+"'s Moves (select one to show detailed results)"),$("#resultHeaderR").text(t.name+"'s Moves (select one to show detailed results)")}function findDamageResult(e){for(var t="#"+e.attr("id"),a=0;a<resultLocations.length;a++)for(var i=0;i<resultLocations[a].length;i++)if(resultLocations[a][i].move===t)return damageResults[a][i]}function CALCULATE_ALL_MOVES_BW(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkKlutz(e),checkKlutz(t),e.stats[DF]=getModifiedStat(e.rawStats[DF],e.boosts[DF]),e.stats[SD]=getModifiedStat(e.rawStats[SD],e.boosts[SD]),e.stats[SP]=getFinalSpeed(e,a.getWeather()),t.stats[DF]=getModifiedStat(t.rawStats[DF],t.boosts[DF]),t.stats[SD]=getModifiedStat(t.rawStats[SD],t.boosts[SD]),t.stats[SP]=getFinalSpeed(t,a.getWeather()),checkIntimidate(e,t),checkIntimidate(t,e),checkDownload(e,t),checkDownload(t,e),e.stats[AT]=getModifiedStat(e.rawStats[AT],e.boosts[AT]),e.stats[SA]=getModifiedStat(e.rawStats[SA],e.boosts[SA]),t.stats[AT]=getModifiedStat(t.rawStats[AT],t.boosts[AT]),t.stats[SA]=getModifiedStat(t.rawStats[SA],t.boosts[SA]);var i=a.getSide(1),r=a.getSide(0);checkInfiltrator(e,i),checkInfiltrator(t,r);for(var s=[[],[]],o=0;o<4;o++)s[0][o]=getDamageResult(e,t,e.moves[o],i),s[1][o]=getDamageResult(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_BW(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkKlutz(e),checkKlutz(t),e.stats[SP]=getFinalSpeed(e,a.getWeather()),t.stats[DF]=getModifiedStat(t.rawStats[DF],t.boosts[DF]),t.stats[SD]=getModifiedStat(t.rawStats[SD],t.boosts[SD]),t.stats[SP]=getFinalSpeed(t,a.getWeather()),checkIntimidate(e,t),checkIntimidate(t,e),checkDownload(e,t),e.stats[AT]=getModifiedStat(e.rawStats[AT],e.boosts[AT]),e.stats[SA]=getModifiedStat(e.rawStats[SA],e.boosts[SA]),t.stats[AT]=getModifiedStat(t.rawStats[AT],t.boosts[AT]);var i=a.getSide(~~("one-vs-all"===mode));checkInfiltrator(e,i);for(var r=[],s=0;s<4;s++)r[s]=getDamageResult(e,t,e.moves[s],i);return r}function getDamageResult(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};var s=t.ability;["Mold Breaker","Teravolt","Turboblaze"].indexOf(e.ability)!==-1&&(s="",r.attackerAbility=e.ability);var o=a.isCrit&&["Battle Armor","Shell Armor"].indexOf(s)===-1;if("Weather Ball"===a.name)a.type=i.weather.indexOf("Sun")!==-1?"Fire":i.weather.indexOf("Rain")!==-1?"Water":"Sand"===i.weather?"Rock":"Hail"===i.weather?"Ice":"Normal",r.weather=i.weather,r.moveType=a.type;else if("Judgment"===a.name&&e.item.indexOf("Plate")!==-1)a.type=getItemBoostType(e.item);else if("Techno Blast"===a.name&&e.item.indexOf("Drive")!==-1)a.type=getTechnoBlast(e.item);else if("Natural Gift"===a.name&&e.item.indexOf("Berry")!==-1){var n=getNaturalGift(e.item);a.type=n.t,a.bp=n.p,r.attackerItem=e.item,r.moveBP=a.bp,r.moveType=a.type}else"Nature Power"===a.name&&(a.type="Electric"===i.terrain?"Electric":"Grassy"===i.terrain?"Grass":"Misty"===i.terrain?"Fairy":"Normal");var l="Aerilate"===e.ability&&"Normal"===a.type,c="Pixilate"===e.ability&&"Normal"===a.type,h="Refrigerate"===e.ability&&"Normal"===a.type;l?a.type="Flying":c?a.type="Fairy":h?a.type="Ice":"Normalize"===e.ability&&(a.type="Normal",r.attackerAbility=e.ability);var d=getMoveEffectiveness(a,t.type1,"Scrappy"===e.ability||i.isForesight,i.isGravity),p=t.type2?getMoveEffectiveness(a,t.type2,"Scrappy"===e.ability||i.isForesight,i.isGravity):1,m=d*p;if(0===m)return{damage:[0],description:buildDescription(r)};if("Sky Drop"===a.name&&("Flying"===t.type1||"Flying"===t.type2||gen>=6&&t.weight>=200||i.isGravity))return{damage:[0],description:buildDescription(r)};if("Synchronoise"===a.name&&[t.type1,t.type2].indexOf(e.type1)===-1&&(!e.type2||[t.type1,t.type2].indexOf(e.type2)===-1))return{damage:[0],description:buildDescription(r)};if("Wonder Guard"===s&&m<=1||"Grass"===a.type&&"Sap Sipper"===s||"Fire"===a.type&&s.indexOf("Flash Fire")!==-1||"Water"===a.type&&["Dry Skin","Storm Drain","Water Absorb"].indexOf(s)!==-1||"Electric"===a.type&&["Lightning Rod","Motor Drive","Volt Absorb"].indexOf(s)!==-1||"Ground"===a.type&&!i.isGravity&&"Levitate"===s||a.isBullet&&"Bulletproof"===s||a.isSound&&"Soundproof"===s)return r.defenderAbility=s,{damage:[0],description:buildDescription(r)};if("Strong Winds"===i.weather&&("Flying"===t.type1||"Flying"===t.type2)&&typeChart[a.type].Flying>1&&(m/=2,r.weather=i.weather),"Ground"===a.type&&!i.isGravity&&"Air Balloon"===t.item)return r.defenderItem=t.item,{damage:[0],description:buildDescription(r)};if(r.HPEVs=t.HPEVs+" HP","Seismic Toss"===a.name||"Night Shade"===a.name){var u=e.level;return"Parental Bond"===e.ability&&(u*=2),{damage:[u],description:buildDescription(r)}}if("Final Gambit"===a.name){var f=e.curHP;return{damage:[f],description:buildDescription(r)}}a.hits>1&&(r.hits=a.hits);var y,S=e.stats[SP]>t.stats[SP]?"FIRST":"LAST";switch(a.name){case"Payback":y="LAST"===S?100:50,r.moveBP=y;break;case"Electro Ball":var b=Math.floor(e.stats[SP]/t.stats[SP]);y=b>=4?150:b>=3?120:b>=2?80:60,r.moveBP=y;break;case"Gyro Ball":y=Math.min(150,Math.floor(25*t.stats[SP]/e.stats[SP])),r.moveBP=y;break;case"Punishment":y=Math.min(200,60+20*countBoosts(t.boosts)),r.moveBP=y;break;case"Low Kick":case"Grass Knot":var v=t.weight;y=v>=200?120:v>=100?100:v>=50?80:v>=25?60:v>=10?40:20,r.moveBP=y;break;case"Hex":y=a.bp*("Healthy"!==t.status?2:1),r.moveBP=y;break;case"Heavy Slam":case"Heat Crash":var g=e.weight/t.weight;y=g>=5?120:g>=4?100:g>=3?80:g>=2?60:40,r.moveBP=y;break;case"Stored Power":y=20+20*countBoosts(e.boosts),r.moveBP=y;break;case"Acrobatics":y="Flying Gem"===e.item||""===e.item?110:55,r.moveBP=y;break;case"Wake-Up Slap":y=a.bp*("Asleep"===t.status?2:1),r.moveBP=y;break;case"Weather Ball":y=""!==i.weather?100:50,r.moveBP=y;break;case"Fling":y=getFlingPower(e.item),r.moveBP=y,r.attackerItem=e.item;break;case"Eruption":case"Water Spout":y=Math.max(1,Math.floor(150*e.curHP/e.maxHP)),r.moveBP=y;break;case"Flail":case"Reversal":var k=Math.floor(48*e.curHP/e.maxHP);y=k<=1?200:k<=4?150:k<=9?100:k<=16?80:k<=32?40:20,r.moveBP=y;break;case"Earthquake":y="Grassy"===i.terrain?a.bp/2:a.bp,r.terrain=i.terrain;break;case"Nature Power":y="Electric"===i.terrain||"Grassy"===i.terrain?90:"Misty"===i.terrain?95:80;break;default:y=a.bp}var M=[];"Technician"===e.ability&&y<=60||"Flare Boost"===e.ability&&"Burned"===e.status&&"Special"===a.category||"Toxic Boost"===e.ability&&("Poisoned"===e.status||"Badly Poisoned"===e.status)&&"Physical"===a.category?(M.push(6144),r.attackerAbility=e.ability):"Analytic"===e.ability&&"FIRST"!==S?(M.push(5325),r.attackerAbility=e.ability):"Sand Force"===e.ability&&"Sand"===i.weather&&["Rock","Ground","Steel"].indexOf(a.type)!==-1?(M.push(5325),r.attackerAbility=e.ability,r.weather=i.weather):("Reckless"===e.ability&&a.hasRecoil||"Iron Fist"===e.ability&&a.isPunch)&&(M.push(4915),r.attackerAbility=e.ability),"Heatproof"===s&&"Fire"===a.type?(M.push(2048),r.defenderAbility=s):"Dry Skin"===s&&"Fire"===a.type&&(M.push(5120),r.defenderAbility=s),"Sheer Force"===e.ability&&a.hasSecondaryEffect&&(M.push(5325),r.attackerAbility=e.ability),getItemBoostType(e.item)===a.type?(M.push(4915),r.attackerItem=e.item):"Muscle Band"===e.item&&"Physical"===a.category||"Wise Glasses"===e.item&&"Special"===a.category?(M.push(4505),r.attackerItem=e.item):!("Adamant Orb"===e.item&&"Dialga"===e.name||"Lustrous Orb"===e.item&&"Palkia"===e.name||"Griseous Orb"===e.item&&"Giratina-O"===e.name)||a.type!==e.type1&&a.type!==e.type2?e.item===a.type+" Gem"&&(M.push(gen>=6?5325:6144),r.attackerItem=e.item):(M.push(4915),r.attackerItem=e.item),"Facade"===a.name&&["Burned","Paralyzed","Poisoned","Badly Poisoned"].indexOf(e.status)!==-1||"Brine"===a.name&&t.curHP<=t.maxHP/2||"Venoshock"===a.name&&("Poisoned"===t.status||"Badly Poisoned"===t.status)?(M.push(8192),r.moveBP=2*a.bp):"Solar Beam"===a.name&&["Rain","Heavy Rain","Sand","Hail"].indexOf(i.weather)!==-1?(M.push(2048),r.moveBP=a.bp/2,r.weather=i.weather):gen>=6&&"Knock Off"===a.name&&!(""===t.item||"Giratina-O"===t.name&&"Griseous Orb"===t.item||t.name.indexOf("Arceus")!==-1&&t.item.indexOf("Plate")!==-1||t.name.indexOf("Genesect")!==-1&&t.item.indexOf("Drive")!==-1)&&(M.push(6144),r.moveBP=1.5*a.bp),i.isHelpingHand&&(M.push(6144),r.isHelpingHand=!0),l||c||h?(M.push(5325),r.attackerAbility=e.ability):"Mega Launcher"===e.ability&&a.isPulse||"Strong Jaw"===e.ability&&a.isBite?(M.push(6144),r.attackerAbility=e.ability):"Tough Claws"===e.ability&&a.makesContact&&(M.push(5325),r.attackerAbility=e.ability);var A=e.ability===a.type+" Aura",P=s===a.type+" Aura";(A||P)&&("Aura Break"===e.ability||"Aura Break"===s?(M.push(3072),r.attackerAbility=e.ability,r.defenderAbility=s):(M.push(5447),A&&(r.attackerAbility=e.ability),P&&(r.defenderAbility=s))),y=Math.max(1,pokeRound(y*chainMods(M)/4096));var T,w="Foul Play"===a.name?t:e,D="Physical"===a.category?AT:SA;r.attackEVs=e.evs[D]+(NATURES[e.nature][0]===D?"+":NATURES[e.nature][1]===D?"-":"")+" "+toSmogonStat(D),0===w.boosts[D]||o&&w.boosts[D]<0?T=w.rawStats[D]:"Unaware"===s?(T=w.rawStats[D],r.defenderAbility=s):(T=w.stats[D],r.attackBoost=w.boosts[D]),"Hustle"===e.ability&&"Physical"===a.category&&(T=pokeRound(3*T/2),r.attackerAbility=e.ability);var x=[];"Thick Fat"!==s||"Fire"!==a.type&&"Ice"!==a.type||(x.push(2048),r.defenderAbility=s),"Guts"===e.ability&&"Healthy"!==e.status&&"Physical"===a.category||"Overgrow"===e.ability&&e.curHP<=e.maxHP/3&&"Grass"===a.type||"Blaze"===e.ability&&e.curHP<=e.maxHP/3&&"Fire"===a.type||"Torrent"===e.ability&&e.curHP<=e.maxHP/3&&"Water"===a.type||"Swarm"===e.ability&&e.curHP<=e.maxHP/3&&"Bug"===a.type?(x.push(6144),r.attackerAbility=e.ability):"Flash Fire (activated)"===e.ability&&"Fire"===a.type?(x.push(6144),r.attackerAbility="Flash Fire"):"Solar Power"===e.ability&&i.weather.indexOf("Sun")!==-1&&"Special"===a.category||"Flower Gift"===e.ability&&i.weather.indexOf("Sun")!==-1&&"Physical"===a.category?(x.push(6144),r.attackerAbility=e.ability,r.weather=i.weather):"Defeatist"===e.ability&&e.curHP<=e.maxHP/2||"Slow Start"===e.ability&&"Physical"===a.category?(x.push(2048),r.attackerAbility=e.ability):"Huge Power"!==e.ability&&"Pure Power"!==e.ability||"Physical"!==a.category||(x.push(8192),r.attackerAbility=e.ability),"Thick Club"===e.item&&("Cubone"===e.name||"Marowak"===e.name)&&"Physical"===a.category||"Deep Sea Tooth"===e.item&&"Clamperl"===e.name&&"Special"===a.category||"Light Ball"===e.item&&"Pikachu"===e.name?(x.push(8192),r.attackerItem=e.item):("Soul Dew"===e.item&&("Latios"===e.name||"Latias"===e.name)&&"Special"===a.category||"Choice Band"===e.item&&"Physical"===a.category||"Choice Specs"===e.item&&"Special"===a.category)&&(x.push(6144),r.attackerItem=e.item),T=Math.max(1,pokeRound(T*chainMods(x)/4096));var E,C="Physical"===a.category||a.dealsPhysicalDamage,L=C?DF:SD;r.defenseEVs=t.evs[L]+(NATURES[t.nature][0]===L?"+":NATURES[t.nature][1]===L?"-":"")+" "+toSmogonStat(L),0===t.boosts[L]||o&&t.boosts[L]>0||a.ignoresDefenseBoosts?E=t.rawStats[L]:"Unaware"===e.ability?(E=t.rawStats[L],r.attackerAbility=e.ability):(E=t.stats[L],r.defenseBoost=t.boosts[L]),"Sand"!==i.weather||"Rock"!==t.type1&&"Rock"!==t.type2||C||(E=pokeRound(3*E/2),r.weather=i.weather);var H=[];"Marvel Scale"===s&&"Healthy"!==t.status&&C?(H.push(6144),r.defenderAbility=s):"Flower Gift"!==s||i.weather.indexOf("Sun")===-1||C||(H.push(6144),r.defenderAbility=s,r.weather=i.weather),("Soul Dew"!==t.item||"Latios"!==t.name&&"Latias"!==t.name||C)&&("Assault Vest"!==t.item||C)&&"Eviolite"!==t.item||(H.push(6144),r.defenderItem=t.item),("Metal Powder"===t.item&&"Ditto"===t.name&&C||"Deep Sea Scale"===t.item&&"Clamperl"===t.name&&!C)&&(H.push(8192),r.defenderItem=t.item),"Fur Coat"===s&&C&&(H.push(8192),r.defenderAbility=s),E=Math.max(1,pokeRound(E*chainMods(H)/4096));var B=Math.floor(Math.floor(Math.floor(2*e.level/5+2)*y*T/E)/50+2);if("Singles"!==i.format&&a.isSpread&&(B=pokeRound(3072*B/4096)),i.weather.indexOf("Sun")!==-1&&"Fire"===a.type||i.weather.indexOf("Rain")!==-1&&"Water"===a.type)B=pokeRound(6144*B/4096),r.weather=i.weather;else if("Sun"===i.weather&&"Water"===a.type||"Rain"===i.weather&&"Fire"===a.type)B=pokeRound(2048*B/4096),r.weather=i.weather;else if("Harsh Sunshine"===i.weather&&"Water"===a.type||"Heavy Rain"===i.weather&&"Fire"===a.type)return{damage:[0],description:buildDescription(r)};(i.isGravity||"Flying"!==e.type1&&"Flying"!==e.type2&&"Air Balloon"!==e.item&&"Levitate"!==e.ability)&&("Electric"===i.terrain&&"Electric"===a.type?(B=pokeRound(6144*B/4096),r.terrain=i.terrain):"Grassy"===i.terrain&&"Grass"==a.type&&(B=pokeRound(6144*B/4096),r.terrain=i.terrain)),(i.isGravity||"Flying"!==t.type1&&"Flying"!==t.type2&&"Air Balloon"!==t.item&&"Levitate"!==t.ability)&&"Misty"===i.terrain&&"Dragon"===a.type&&(B=pokeRound(2048*B/4096),r.terrain=i.terrain),o&&(B=Math.floor(B*(gen>=6?1.5:2)),r.isCritical=o);var $=4096;a.type===e.type1||a.type===e.type2?"Adaptability"===e.ability?($=8192,r.attackerAbility=e.ability):$=6144:"Protean"===e.ability&&($=6144,r.attackerAbility=e.ability);var _="Burned"===e.status&&"Physical"===a.category&&"Guts"!==e.ability&&!a.ignoresBurn;r.isBurned=_;var F=[];i.isReflect&&"Physical"===a.category&&!o?(F.push("Singles"!==i.format?2703:2048),r.isReflect=!0):i.isLightScreen&&"Special"===a.category&&!o&&(F.push("Singles"!==i.format?2703:2048),r.isLightScreen=!0),"Multiscale"===s&&t.curHP===t.maxHP&&(F.push(2048),r.defenderAbility=s),"Tinted Lens"===e.ability&&m<1&&(F.push(8192),r.attackerAbility=e.ability),i.isFriendGuard&&(F.push(3072),r.isFriendGuard=!0),"Sniper"===e.ability&&o&&(F.push(6144),r.attackerAbility=e.ability),("Solid Rock"===s||"Filter"===s)&&m>1&&(F.push(3072),r.defenderAbility=s),"Expert Belt"===e.item&&m>1?(F.push(4915),r.attackerItem=e.item):"Life Orb"===e.item&&(F.push(5324),r.attackerItem=e.item),getBerryResistType(t.item)===a.type&&(m>1||"Normal"===a.type)&&"Unnerve"!==e.ability&&(F.push(2048),r.defenderItem=t.item);for(var R=chainMods(F),O=[],G=0;G<16;G++)O[G]=Math.floor(B*(85+G)/100),O[G]=pokeRound(O[G]*$/4096),O[G]=Math.floor(O[G]*m),_&&(O[G]=Math.floor(O[G]/2)),O[G]=Math.max(1,O[G]),O[G]=pokeRound(O[G]*R/4096),"Parental Bond"!==e.ability||1!==a.hits||"Singles"!==i.format&&a.isSpread||(O[G]=Math.floor(3*O[G]/2),r.attackerAbility=e.ability);return{damage:O,description:buildDescription(r)}}function buildDescription(e){var t="";return e.attackBoost&&(e.attackBoost>0&&(t+="+"),t+=e.attackBoost+" "),t=appendIfSet(t,e.attackEVs),t=appendIfSet(t,e.attackerItem),t=appendIfSet(t,e.attackerAbility),e.isBurned&&(t+="burned "),t+=e.attackerName+" ",e.isHelpingHand&&(t+="Helping Hand "),t+=e.moveName+" ",e.moveBP&&e.moveType?t+="("+e.moveBP+" BP "+e.moveType+") ":e.moveBP?t+="("+e.moveBP+" BP) ":e.moveType&&(t+="("+e.moveType+") "),e.hits&&(t+="("+e.hits+" hits) "),t+="vs. ",e.defenseBoost&&(e.defenseBoost>0&&(t+="+"),t+=e.defenseBoost+" "),t=appendIfSet(t,e.HPEVs),e.defenseEVs&&(t+=" / "+e.defenseEVs+" "),t=appendIfSet(t,e.defenderItem),t=appendIfSet(t,e.defenderAbility),t+=e.defenderName,e.weather&&e.terrain||(e.weather?t+=" in "+e.weather:e.terrain&&(t+=" in "+e.terrain+" Terrain")),e.isReflect?t+=" through Reflect":e.isLightScreen&&(t+=" through Light Screen"),e.isFriendGuard&&(t+=" with an ally's Friend Guard"),e.isCritical&&(t+=" on a critical hit"),t}function appendIfSet(e,t){return t?e+t+" ":e}function toSmogonStat(e){return e===AT?"Atk":e===DF?"Def":e===SA?"SpA":e===SD?"SpD":e===SP?"Spe":"wtf"}function chainMods(e){for(var t=4096,a=0;a<e.length;a++)4096!==e[a]&&(t=t*e[a]+2048>>12);return t}function getMoveEffectiveness(e,t,a,i){return!a||"Ghost"!==t||"Normal"!==e.type&&"Fighting"!==e.type?i&&"Flying"===t&&"Ground"===e.type?1:"Freeze-Dry"===e.name&&"Water"===t?2:"Flying Press"===e.name?typeChart.Fighting[t]*typeChart.Flying[t]:typeChart[e.type][t]:1}function getModifiedStat(e,t){return t>0?Math.floor(e*(2+t)/2):t<0?Math.floor(2*e/(2-t)):e}function getFinalSpeed(e,t){var a=getModifiedStat(e.rawStats[SP],e.boosts[SP]);return"Choice Scarf"===e.item?a=Math.floor(1.5*a):"Macho Brace"!==e.item&&"Iron Ball"!==e.item||(a=Math.floor(a/2)),("Chlorophyll"===e.ability&&t.indexOf("Sun")!==-1||"Sand Rush"===e.ability&&"Sand"===t||"Swift Swim"===e.ability&&t.indexOf("Rain")!==-1)&&(a*=2),a}function checkAirLock(e,t){"Air Lock"!==e.ability&&"Cloud Nine"!==e.ability||t.clearWeather()}function checkForecast(e,t){"Forecast"===e.ability&&"Castform"===e.name&&(t.indexOf("Sun")!==-1?e.type1="Fire":t.indexOf("Rain")!==-1?e.type1="Water":"Hail"===t?e.type1="Ice":e.type1="Normal",e.type2="")}function checkKlutz(e){"Klutz"===e.ability&&(e.item="")}function checkIntimidate(e,t){"Intimidate"===e.ability&&("Contrary"===t.ability||"Defiant"===t.ability?t.boosts[AT]=Math.min(6,t.boosts[AT]+1):["Clear Body","White Smoke","Hyper Cutter"].indexOf(t.ability)!==-1||("Simple"===t.ability?t.boosts[AT]=Math.max(-6,t.boosts[AT]-2):t.boosts[AT]=Math.max(-6,t.boosts[AT]-1)))}function checkDownload(e,t){"Download"===e.ability&&(t.stats[SD]<=t.stats[DF]?e.boosts[SA]=Math.min(6,e.boosts[SA]+1):e.boosts[AT]=Math.min(6,e.boosts[AT]+1))}function checkInfiltrator(e,t){"Infiltrator"===e.ability&&(t.isReflect=!1,t.isLightScreen=!1)}function countBoosts(e){for(var t=0,a=0;a<STATS.length;a++)e[STATS[a]]>0&&(t+=e[STATS[a]]);return t}function pokeRound(e){return e%1>.5?Math.ceil(e):Math.floor(e)}function CALCULATE_ALL_MOVES_DPP(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkKlutz(e),checkKlutz(t),checkIntimidate(e,t),checkIntimidate(t,e),checkDownload(e,t),checkDownload(t,e),e.stats[SP]=getFinalSpeed(e,a.getWeather()),t.stats[SP]=getFinalSpeed(t,a.getWeather());for(var i=a.getSide(1),r=a.getSide(0),s=[[],[]],o=0;o<4;o++)s[0][o]=CALCULATE_DAMAGE_DPP(e,t,e.moves[o],i),s[1][o]=CALCULATE_DAMAGE_DPP(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_DPP(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkKlutz(e),checkKlutz(t),checkIntimidate(e,t),checkIntimidate(t,e),checkDownload(e,t),e.stats[SP]=getFinalSpeed(e,a.getWeather()),t.stats[SP]=getFinalSpeed(t,a.getWeather());for(var i=a.getSide(~~("one-vs-all"===mode)),r=[],s=0;s<4;s++)r[s]=CALCULATE_DAMAGE_DPP(e,t,e.moves[s],i);return r}function CALCULATE_DAMAGE_DPP(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};var s=t.ability;"Mold Breaker"===e.ability&&(s="",r.attackerAbility=e.ability);var o=a.isCrit&&["Battle Armor","Shell Armor"].indexOf(s)===-1;if("Weather Ball"===a.name)"Sun"===i.weather?(a.type="Fire",a.bp*=2):"Rain"===i.weather?(a.type="Water",a.bp*=2):"Sand"===i.weather?(a.type="Rock",a.bp*=2):"Hail"===i.weather?(a.type="Ice",a.bp*=2):a.type="Normal",r.weather=i.weather,r.moveType=a.type,r.moveBP=f;else if("Judgment"===a.name&&e.item.indexOf("Plate")!==-1)a.type=getItemBoostType(e.item);else if("Natural Gift"===a.name&&e.item.indexOf("Berry")!==-1){var n=getNaturalGift(e.item);a.type=n.t,a.bp=n.p,r.attackerItem=e.item,r.moveBP=a.bp,r.moveType=a.type}"Normalize"===e.ability&&(a.type="Normal",r.attackerAbility=e.ability);var l=getMoveEffectiveness(a,t.type1,"Scrappy"===e.ability||i.isForesight,i.isGravity),c=t.type2?getMoveEffectiveness(a,t.type2,"Scrappy"===e.ability||i.isForesight,i.isGravity):1,h=l*c;if(0===h)return{damage:[0],description:buildDescription(r)};if("Wonder Guard"===s&&h<=1||"Fire"===a.type&&s.indexOf("Flash Fire")!==-1||"Water"===a.type&&["Dry Skin","Water Absorb"].indexOf(s)!==-1||"Electric"===a.type&&["Motor Drive","Volt Absorb"].indexOf(s)!==-1||"Ground"===a.type&&!i.isGravity&&"Levitate"===s||a.isSound&&"Soundproof"===s)return r.defenderAbility=s,{damage:[0],description:buildDescription(r)};if(r.HPEVs=t.HPEVs+" HP","Seismic Toss"===a.name||"Night Shade"===a.name)return{damage:[e.level],description:buildDescription(r)};a.hits>1&&(r.hits=a.hits);var d=e.stats[SP]>t.stats[SP]?"FIRST":"LAST";switch(a.name){case"Brine":t.curHP<=t.maxHP/2&&(a.bp*=2,r.moveBP=a.bp);break;case"Eruption":case"Water Spout":a.bp=Math.max(1,Math.floor(a.bp*e.curHP/e.maxHP)),r.moveBP=a.bp;break;case"Facade":["Paralyzed","Poisoned","Badly Poisoned","Burned"].indexOf(e.status)!==-1&&(a.bp*=2,r.moveBP=a.bp);break;case"Flail":case"Reversal":var p=Math.floor(48*e.curHP/e.maxHP);a.bp=p<=1?200:p<=4?150:p<=9?100:p<=16?80:p<=32?40:20,r.moveBP=a.bp;break;case"Fling":a.bp=getFlingPower(e.item),r.moveBP=a.bp,r.attackerItem=e.item;break;case"Grass Knot":case"Low Kick":var m=t.weight;a.bp=m>=200?120:m>=100?100:m>=50?80:m>=25?60:m>=10?40:20,r.moveBP=a.bp;break;case"Gyro Ball":a.bp=Math.min(150,Math.floor(25*t.stats[SP]/e.stats[SP])),r.moveBP=a.bp;break;case"Payback":"FIRST"!==d&&(a.bp*=2,r.moveBP=a.bp);break;case"Punishment":var u=countBoosts(t.boosts);u>0&&(a.bp=Math.min(200,a.bp+20*u),r.moveBP=a.bp);break;case"Wake-Up Slap":"Asleep"===t.status&&(a.bp*=2,r.moveBP=a.bp)}var f=a.bp;i.isHelpingHand&&(f=Math.floor(1.5*f),r.isHelpingHand=!0);var y="Physical"===a.category;"Muscle Band"===e.item&&y||"Wise Glasses"===e.item&&!y?(f=Math.floor(1.1*f),r.attackerItem=e.item):(getItemBoostType(e.item)===a.type||("Adamant Orb"===e.item&&"Dialga"===e.name||"Lustrous Orb"===e.item&&"Palkia"===e.name||"Griseous Orb"===e.item&&"Giratina-O"===e.name)&&(a.type===e.type1||a.type===e.type2))&&(f=Math.floor(1.2*f),r.attackerItem=e.item),"Reckless"===e.ability&&a.hasRecoil||"Iron Fist"===e.ability&&a.isPunch?(f=Math.floor(1.2*f),r.attackerAbility=e.ability):(e.curHP<=e.maxHP/3&&("Overgrow"===e.ability&&"Grass"===a.type||"Blaze"===e.ability&&"Fire"===a.type||"Torrent"===e.ability&&"Water"===a.type||"Swarm"===e.ability&&"Bug"===a.type)||"Technician"===e.ability&&a.bp<=60)&&(f=Math.floor(1.5*f),r.attackerAbility=e.ability),"Thick Fat"===s&&("Fire"===a.type||"Ice"===a.type)||"Heatproof"===s&&"Fire"===a.type?(f=Math.floor(.5*f),r.defenderAbility=s):"Dry Skin"===s&&"Fire"===a.type&&(f=Math.floor(1.25*f),
r.defenderAbility=s);var S=y?AT:SA;r.attackEVs=e.evs[S]+(NATURES[e.nature][0]===S?"+":NATURES[e.nature][1]===S?"-":"")+" "+toSmogonStat(S);var b,v=e.boosts[S],g=e.rawStats[S];0===v||o&&v<0?b=g:"Unaware"===s?(b=g,r.defenderAbility=s):"Simple"===e.ability?(b=getSimpleModifiedStat(g,v),r.attackerAbility=e.ability,r.attackBoost=v):(b=getModifiedStat(g,v),r.attackBoost=v),!y||"Pure Power"!==e.ability&&"Huge Power"!==e.ability?"Sun"===i.weather&&(y?"Flower Gift"===e.ability:"Solar Power"===e.ability)?(b=Math.floor(1.5*b),r.attackerAbility=e.ability,r.weather=i.weather):y&&("Hustle"===e.ability||"Guts"===e.ability&&"Healthy"!==e.status)&&(b=Math.floor(1.5*b),r.attackerAbility=e.ability):(b*=2,r.attackerAbility=e.ability),(y?"Choice Band"!==e.item:"Choice Specs"!==e.item)&&("Soul Dew"!==e.item||"Latios"!==e.name&&"Latias"!==e.name||y)?("Light Ball"===e.item&&"Pikachu"===e.name||"Thick Club"===e.item&&("Cubone"===e.name||"Marowak"===e.name)&&y||"Deep Sea Tooth"===e.item&&"Clamperl"===e.name&&!y)&&(b*=2,r.attackerItem=e.item):(b=Math.floor(1.5*b),r.attackerItem=e.item);var k=y?DF:SD;r.defenseEVs=t.evs[k]+(NATURES[t.nature][0]===k?"+":NATURES[t.nature][1]===k?"-":"")+" "+toSmogonStat(k);var M,A=t.boosts[k],P=t.rawStats[k];0===A||o&&A>0?M=P:"Unaware"===e.ability?(M=P,r.attackerAbility=e.ability):"Simple"===s?(M=getSimpleModifiedStat(P,A),r.defenderAbility=s,r.defenseBoost=A):(M=getModifiedStat(P,A),r.defenseBoost=A),"Marvel Scale"===s&&"Healthy"!==t.status&&y?(M=Math.floor(1.5*M),r.defenderAbility=s):"Flower Gift"!==s||"Sun"!==i.weather||y||(M=Math.floor(1.5*M),r.defenderAbility=s,r.weather=i.weather),"Soul Dew"!==t.item||"Latios"!==t.name&&"Latias"!==t.name||y?("Deep Sea Scale"===t.item&&"Clamperl"===t.name&&!y||"Metal Powder"===t.item&&"Ditto"===t.name&&y)&&(M*=2,r.defenderItem=t.item):(M=Math.floor(1.5*M),r.defenderItem=t.item),"Sand"!==i.weather||"Rock"!==t.type1&&"Rock"!==t.type2||y||(M=Math.floor(1.5*M),r.weather=i.weather),"Explosion"!==a.name&&"Self-Destruct"!==a.name||(M=Math.floor(.5*M)),M<1&&(M=1);var T=Math.floor(Math.floor(Math.floor(2*e.level/5+2)*f*b/50)/M);if("Burned"===e.status&&y&&"Guts"!==e.ability&&(T=Math.floor(.5*T),r.isBurned=!0),!o){var w="Singles"!==i.format?2/3:.5;y&&i.isReflect?(T=Math.floor(T*w),r.isReflect=!0):!y&&i.isLightScreen&&(T=Math.floor(T*w),r.isLightScreen=!0)}"Singles"!==i.format&&a.isSpread&&(T=Math.floor(3*T/4)),"Sun"===i.weather&&"Fire"===a.type||"Rain"===i.weather&&"Water"===a.type?(T=Math.floor(1.5*T),r.weather=i.weather):("Sun"===i.weather&&"Water"===a.type||"Rain"===i.weather&&"Fire"===a.type||["Rain","Sand","Hail"].indexOf(i.weather)!==-1&&"Solar Beam"===a.name)&&(T=Math.floor(.5*T),r.weather=i.weather),"Flash Fire (activated)"===e.ability&&"Fire"===a.type&&(T=Math.floor(1.5*T),r.attackerAbility="Flash Fire"),T+=2,o&&("Sniper"===e.ability?(T*=3,r.attackerAbility=e.ability):T*=2,r.isCritical=o),"Life Orb"===e.item&&(T=Math.floor(1.3*T),r.attackerItem=e.item);var D=1;a.type!==e.type1&&a.type!==e.type2||("Adaptability"===e.ability?(D=2,r.attackerAbility=e.ability):D=1.5);var x=1;("Filter"===s||"Solid Rock"===s)&&h>1&&(x=.75,r.defenderAbility=s);var E=1;"Expert Belt"===e.item&&h>1&&(E=1.2,r.attackerItem=e.item);var C=1;"Tinted Lens"===e.ability&&h<1&&(C=2,r.attackerAbility=e.ability);var L=1;getBerryResistType(t.item)===a.type&&(h>1||"Normal"===a.type)&&(L=.5,r.defenderItem=t.item);for(var H=[],B=0;B<16;B++)H[B]=Math.floor(T*(85+B)/100),H[B]=Math.floor(H[B]*D),H[B]=Math.floor(H[B]*l),H[B]=Math.floor(H[B]*c),H[B]=Math.floor(H[B]*x),H[B]=Math.floor(H[B]*E),H[B]=Math.floor(H[B]*C),H[B]=Math.floor(H[B]*L),H[B]=Math.max(1,H[B]);return{damage:H,description:buildDescription(r)}}function getSimpleModifiedStat(e,t){var a=Math.min(6,Math.max(-6,2*t));return a>0?Math.floor(e*(2+a)/2):a<0?Math.floor(2*e/(2-a)):e}function CALCULATE_ALL_MOVES_ADV(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkIntimidate(e,t),checkIntimidate(t,e);for(var i=a.getSide(1),r=a.getSide(0),s=[[],[]],o=0;o<4;o++)s[0][o]=CALCULATE_DAMAGE_ADV(e,t,e.moves[o],i),s[1][o]=CALCULATE_DAMAGE_ADV(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_ADV(e,t,a){checkAirLock(e,a),checkAirLock(t,a),checkForecast(e,a.getWeather()),checkForecast(t,a.getWeather()),checkIntimidate(e,t),checkIntimidate(t,e);for(var i=a.getSide(~~("one-vs-all"===mode)),r=[],s=0;s<4;s++)r[s]=CALCULATE_DAMAGE_ADV(e,t,e.moves[s],i);return r}function CALCULATE_DAMAGE_ADV(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};"Weather Ball"===a.name&&(a.type="Sun"===i.weather?"Fire":"Rain"===i.weather?"Water":"Sand"===i.weather?"Rock":"Hail"===i.weather?"Ice":"Normal",r.weather=i.weather,r.moveType=a.type,r.moveBP=a.bp);var s=getMoveEffectiveness(a,t.type1,i.isForesight),o=t.type2?getMoveEffectiveness(a,t.type2,i.isForesight):1,n=s*o;if(0===n)return{damage:[0],description:buildDescription(r)};if(t.ability.indexOf("Flash Fire")!==-1&&"Fire"===a.type||"Levitate"===t.ability&&"Ground"===a.type||"Volt Absorb"===t.ability&&"Electric"===a.type||"Water Absorb"===t.ability&&"Water"===a.type||"Wonder Guard"===t.ability&&n<=1||"Soundproof"===t.ability&&a.isSound)return r.defenderAbility=t.ability,{damage:[0],description:buildDescription(r)};r.HPEVs=t.HPEVs+" HP";var l=e.level;if("Seismic Toss"===a.name||"Night Shade"===a.name)return{damage:[l],description:buildDescription(r)};a.hits>1&&(r.hits=a.hits);var c;switch(a.name){case"Flail":case"Reversal":var h=Math.floor(48*e.curHP/e.maxHP);c=h<=1?200:h<=4?150:h<=9?100:h<=16?80:h<=32?40:20,r.moveBP=c;break;case"Eruption":case"Water Spout":c=Math.max(1,Math.floor(150*e.curHP/e.maxHP)),r.moveBP=c;break;case"Low Kick":var d=t.weight;c=d>=200?120:d>=100?100:d>=50?80:d>=25?60:d>=10?40:20,r.moveBP=c;break;default:c=a.bp}var p="Physical"===typeChart[a.type].category,m=p?AT:SA;r.attackEVs=e.evs[m]+(NATURES[e.nature][0]===m?"+":NATURES[e.nature][1]===m?"-":"")+" "+toSmogonStat(m);var u=p?DF:SD;r.defenseEVs=t.evs[u]+(NATURES[t.nature][0]===u?"+":NATURES[t.nature][1]===u?"-":"")+" "+toSmogonStat(u);var f=e.rawStats[m],y=t.rawStats[u];!p||"Huge Power"!==e.ability&&"Pure Power"!==e.ability||(f*=2,r.attackerAbility=e.ability),getItemBoostType(e.item)===a.type?(f=Math.floor(1.1*f),r.attackerItem=e.item):p&&"Choice Band"===e.item||!p&&"Soul Dew"===e.item&&("Latios"===e.name||"Latias"===e.name)?(f=Math.floor(1.5*f),r.attackerItem=e.item):(!p&&"Deep Sea Tooth"===e.item&&"Clamperl"===e.name||!p&&"Light Ball"===e.item&&"Pikachu"===e.name||p&&"Thick Club"===e.item&&("Cubone"===e.name||"Marowak"===e.name))&&(f*=2,r.attackerItem=e.item),p||"Soul Dew"!==t.item||"Latios"!==t.name&&"Latias"!==t.name?(!p&&"Deep Sea Scale"===t.item&&"Clamperl"===t.name||p&&"Metal Powder"===t.item&&"Ditto"===t.name)&&(y*=2,r.defenderItem=t.item):(y=Math.floor(1.5*y),r.defenderItem=t.item),"Thick Fat"!==t.ability||"Fire"!==a.type&&"Ice"!==a.type?p&&"Marvel Scale"===t.ability&&"Healthy"!==t.status&&(y=Math.floor(1.5*y),r.defenderAbility=t.ability):(f=Math.floor(f/2),r.defenderAbility=t.ability),p&&("Hustle"===e.ability||"Guts"===e.ability&&"Healthy"!==e.status)?(f=Math.floor(1.5*f),r.attackerAbility=e.ability):e.curHP<=e.maxHP/3&&("Overgrow"===e.ability&&"Grass"===a.type||"Blaze"===e.ability&&"Fire"===a.type||"Torrent"===e.ability&&"Water"===a.type||"Swarm"===e.ability&&"Bug"===a.type)&&(c=Math.floor(1.5*c),r.attackerAbility=e.ability),"Explosion"!==a.name&&"Self-Destruct"!==a.name||(y=Math.floor(y/2));var S=a.isCrit&&["Battle Armor","Shell Armor"].indexOf(t.ability)===-1,b=e.boosts[m],v=t.boosts[u];(b>0||!S&&b<0)&&(f=getModifiedStat(f,b),r.attackBoost=b),(v<0||!S&&v>0)&&(y=getModifiedStat(y,v),r.defenseBoost=v);var g=Math.floor(Math.floor(Math.floor(2*l/5+2)*f*c/y)/50);if("Burned"===e.status&&p&&"Guts"!==e.ability&&(g=Math.floor(g/2),r.isBurned=!0),!S){var k="Singles"!==i.format?2/3:.5;p&&i.isReflect?(g=Math.floor(g*k),r.isReflect=!0):!p&&i.isLightScreen&&(g=Math.floor(g*k),r.isLightScreen=!0)}"Singles"!==i.format&&a.isSpread&&(g=Math.floor(3*g/4)),"Sun"===i.weather&&"Fire"===a.type||"Rain"===i.weather&&"Water"===a.type?(g=Math.floor(1.5*g),r.weather=i.weather):("Sun"===i.weather&&"Water"===a.type||"Rain"===i.weather&&"Fire"===a.type||"Solar Beam"===a.name&&["Rain","Sand","Hail"].indexOf(i.weather)!==-1)&&(g=Math.floor(g/2),r.weather=i.weather),"Flash Fire (activated)"===e.ability&&"Fire"===a.type&&(g=Math.floor(1.5*g),r.attackerAbility="Flash Fire"),g=Math.max(1,g)+2,S&&(g*=2,r.isCritical=!0),"Weather Ball"===a.name&&""!==i.weather&&(g*=2,r.moveBP=2*a.bp),i.isHelpingHand&&(g=Math.floor(1.5*g),r.isHelpingHand=!0),a.type!==e.type1&&a.type!==e.type2||(g=Math.floor(1.5*g)),g=Math.floor(g*n);for(var M=[],A=85;A<=100;A++)M[A-85]=Math.max(1,Math.floor(g*A/100));return{damage:M,description:buildDescription(r)}}function CALCULATE_ALL_MOVES_GSC(e,t,a){e.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[AT],e.boosts[AT]))),e.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[DF],e.boosts[DF]))),e.stats[SA]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SA],e.boosts[SA]))),e.stats[SD]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SD],e.boosts[SD]))),t.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[AT],t.boosts[AT]))),t.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[DF],t.boosts[DF]))),t.stats[SA]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SA],t.boosts[SA]))),t.stats[SD]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SD],t.boosts[SD])));for(var i=a.getSide(1),r=a.getSide(0),s=[[],[]],o=0;o<4;o++)s[0][o]=CALCULATE_DAMAGE_GSC(e,t,e.moves[o],i),s[1][o]=CALCULATE_DAMAGE_GSC(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_GSC(e,t,a){e.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[AT],e.boosts[AT]))),e.stats[SA]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SA],e.boosts[SA]))),t.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[DF],t.boosts[DF]))),t.stats[SD]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SD],t.boosts[SD])));for(var i=a.getSide(~~("one-vs-all"===mode)),r=[],s=0;s<4;s++)r[s]=CALCULATE_DAMAGE_GSC(e,t,e.moves[s],i);return r}function CALCULATE_DAMAGE_GSC(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};var s=getMoveEffectiveness(a,t.type1,i.isForesight),o=t.type2?getMoveEffectiveness(a,t.type2,i.isForesight):1,n=s*o;if(0===n)return{damage:[0],description:buildDescription(r)};var l=e.level;if("Seismic Toss"===a.name||"Night Shade"===a.name)return{damage:[l],description:buildDescription(r)};if(a.hits>1&&(r.hits=a.hits),"Flail"===a.name||"Reversal"===a.name){a.isCrit=!1;var c=Math.floor(48*e.curHP/e.maxHP);a.bp=c<=1?200:c<=4?150:c<=9?100:c<=16?80:c<=32?40:20,r.moveBP=a.bp}var h="Physical"===typeChart[a.type].category,d=h?AT:SA,p=h?DF:SD,m=e.stats[d],u=t.stats[p],f=a.isCrit&&e.boosts[d]<=t.boosts[p];f?(m=e.rawStats[d],u=t.rawStats[p]):(0!==e.boosts[d]&&(r.attackBoost=e.boosts[d]),0!==t.boosts[p]&&(r.defenseBoost=t.boosts[p]),h&&"Burned"===e.status&&(m=Math.floor(m/2),r.isBurned=!0)),"Explosion"!==a.name&&"Self-Destruct"!==a.name||(u=Math.floor(u/2)),f||(h&&i.isReflect?(u*=2,r.isReflect=!0):!h&&i.isLightScreen&&(u*=2,r.isLightScreen=!0)),("Pikachu"===e.name&&"Light Ball"===e.item&&!h||("Cubone"===e.name||"Marowak"===e.name)&&"Thick Club"===e.item&&h)&&(m*=2,r.attackerItem=e.item),(m>255||u>255)&&(m=Math.floor(m/4)%256,u=Math.floor(u/4)%256),"Ditto"===t.name&&"Metal Powder"===t.item&&(u=Math.floor(1.5*u),r.defenderItem=t.item);var y=Math.floor(Math.floor(Math.floor(2*l/5+2)*Math.max(1,m)*a.bp/Math.max(1,u))/50);if(a.isCrit&&(y*=2,r.isCritical=!0),getItemBoostType(e.item)===a.type&&(y=Math.floor(1.1*y),r.attackerItem=e.item),y=Math.min(997,y)+2,"Sun"===i.weather&&"Fire"===a.type||"Rain"===i.weather&&"Water"===a.type?(y=Math.floor(1.5*y),r.weather=i.weather):("Sun"===i.weather&&"Water"===a.type||"Rain"===i.weather&&("Fire"===a.type||"Solar Beam"===a.name))&&(y=Math.floor(y/2),r.weather=i.weather),a.type!==e.type1&&a.type!==e.type2||(y=Math.floor(1.5*y)),y=Math.floor(y*n),"Flail"===a.name||"Reversal"===a.name)return{damage:[y],description:buildDescription(r)};for(var S=[],b=217;b<=255;b++)S[b-217]=Math.floor(y*b/255);return{damage:S,description:buildDescription(r)}}function CALCULATE_ALL_MOVES_RBY(e,t,a){e.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[AT],e.boosts[AT]))),e.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[DF],e.boosts[DF]))),e.stats[SL]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SL],e.boosts[SL]))),t.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[AT],t.boosts[AT]))),t.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[DF],t.boosts[DF]))),t.stats[SL]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SL],t.boosts[SL])));for(var i=a.getSide(1),r=a.getSide(0),s=[[],[]],o=0;o<4;o++)s[0][o]=CALCULATE_DAMAGE_RBY(e,t,e.moves[o],i),s[1][o]=CALCULATE_DAMAGE_RBY(t,e,t.moves[o],r);return s}function CALCULATE_MOVES_OF_ATTACKER_RBY(e,t,a){e.stats[AT]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[AT],e.boosts[AT]))),e.stats[SL]=Math.min(999,Math.max(1,getModifiedStat(e.rawStats[SL],e.boosts[SL]))),t.stats[DF]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[DF],t.boosts[DF]))),t.stats[SL]=Math.min(999,Math.max(1,getModifiedStat(t.rawStats[SL],t.boosts[SL])));for(var i=a.getSide(~~("one-vs-all"===mode)),r=[],s=0;s<4;s++)r[s]=CALCULATE_DAMAGE_RBY(e,t,e.moves[s],i);return r}function CALCULATE_DAMAGE_RBY(e,t,a,i){var r={attackerName:e.name,moveName:a.name,defenderName:t.name};if(0===a.bp)return{damage:[0],description:buildDescription(r)};var s=e.level;if("Seismic Toss"===a.name||"Night Shade"===a.name)return{damage:[s],description:buildDescription(r)};var o=typeChart[a.type][t.type1],n=t.type2?typeChart[a.type][t.type2]:1,l=o*n;if(0===l)return{damage:[0],description:buildDescription(r)};a.hits>1&&(r.hits=a.hits);var c="Physical"===typeChart[a.type].category,h=c?AT:SL,d=c?DF:SL,p=e.stats[h],m=t.stats[d];a.isCrit?(s*=2,p=e.rawStats[h],m=t.rawStats[d],r.isCritical=!0):(0!==e.boosts[h]&&(r.attackBoost=e.boosts[h]),0!==t.boosts[d]&&(r.defenseBoost=t.boosts[d]),c&&"Burned"===e.status&&(p=Math.floor(p/2),r.isBurned=!0)),"Explosion"!==a.name&&"Self-Destruct"!==a.name||(m=Math.floor(m/2)),a.isCrit||(c&&i.isReflect?(m*=2,r.isReflect=!0):!c&&i.isLightScreen&&(m*=2,r.isLightScreen=!0)),(p>255||m>255)&&(p=Math.floor(p/4)%256,m=Math.floor(m/4)%256);var u=Math.min(997,Math.floor(Math.floor(Math.floor(2*s/5+2)*Math.max(1,p)*a.bp/Math.max(1,m))/50))+2;a.type!==e.type1&&a.type!==e.type2||(u=Math.floor(1.5*u)),u=Math.floor(u*l);for(var f=[],y=217;y<=255;y++)f[y-217]=Math.floor(u*y/255);return{damage:f,description:buildDescription(r)}}function getKOChanceText(e,t,a,i,r){if(isNaN(e[0]))return"something broke; please tell Austin or Marty";if(0===e[e.length-1])return"aim for the horn next time";if(e[0]>=t.maxHP)return"guaranteed OHKO";var s=0,o=[];if(a.isSR&&"Magic Guard"!==t.ability){var n=typeChart.Rock[t.type1]*(t.type2?typeChart.Rock[t.type2]:1);s+=Math.floor(n*t.maxHP/8),o.push("Stealth Rock")}[t.type1,t.type2].indexOf("Flying")===-1&&["Magic Guard","Levitate"].indexOf(t.ability)===-1&&"Air Balloon"!==t.item&&(1===a.spikes?(s+=Math.floor(t.maxHP/8),2===gen?o.push("Spikes"):o.push("1 layer of Spikes")):2===a.spikes?(s+=Math.floor(t.maxHP/6),o.push("2 layers of Spikes")):3===a.spikes&&(s+=Math.floor(t.maxHP/4),o.push("3 layers of Spikes"))),isNaN(s)&&(s=0);var l=0,c=[];"Sun"===a.weather||"Harsh Sunshine"===a.weather?"Dry Skin"!==t.ability&&"Solar Power"!==t.ability||(l-=Math.floor(t.maxHP/8),c.push(t.ability+" damage")):"Rain"===a.weather||"Heavy Rain"===a.weather?"Dry Skin"===t.ability?(l+=Math.floor(t.maxHP/8),c.push("Dry Skin recovery")):"Rain Dish"===t.ability&&(l+=Math.floor(t.maxHP/16),c.push("Rain Dish recovery")):"Sand"===a.weather?["Rock","Ground","Steel"].indexOf(t.type1)===-1&&["Rock","Ground","Steel"].indexOf(t.type2)===-1&&["Magic Guard","Overcoat","Sand Force","Sand Rush","Sand Veil"].indexOf(t.ability)===-1&&"Safety Goggles"!==t.item&&(l-=Math.floor(t.maxHP/16),c.push("sandstorm damage")):"Hail"===a.weather&&("Ice Body"===t.ability?(l+=Math.floor(t.maxHP/16),c.push("Ice Body recovery")):"Ice"!==t.type1&&"Ice"!==t.type2&&["Magic Guard","Overcoat","Snow Cloak"].indexOf(t.ability)===-1&&"Safety Goggles"!==t.item&&(l-=Math.floor(t.maxHP/16),c.push("hail damage"))),"Leftovers"===t.item?(l+=Math.floor(t.maxHP/16),c.push("Leftovers recovery")):"Black Sludge"===t.item&&("Poison"===t.type1||"Poison"===t.type2?(l+=Math.floor(t.maxHP/16),c.push("Black Sludge recovery")):"Magic Guard"!==t.ability&&"Klutz"!==t.ability&&(l-=Math.floor(t.maxHP/8),c.push("Black Sludge damage"))),"Grassy"===a.terrain&&(a.isGravity||"Flying"!==t.type1&&"Flying"!==t.type2&&"Air Balloon"!==t.item&&"Levitate"!==t.ability)&&(l+=Math.floor(t.maxHP/16),c.push("Grassy Terrain recovery"));var h=0;"Poisoned"===t.status?"Poison Heal"===t.ability?(l+=Math.floor(t.maxHP/8),c.push("Poison Heal")):"Magic Guard"!==t.ability&&(l-=Math.floor(t.maxHP/8),c.push("poison damage")):"Badly Poisoned"===t.status?"Poison Heal"===t.ability?(l+=Math.floor(t.maxHP/8),c.push("Poison Heal")):"Magic Guard"!==t.ability&&(c.push("toxic damage"),h=t.toxicCounter):"Burned"===t.status?"Heatproof"===t.ability?(l-=Math.floor(t.maxHP/16),c.push("reduced burn damage")):"Magic Guard"!==t.ability&&(l-=Math.floor(t.maxHP/8),c.push("burn damage")):"Asleep"===t.status&&r&&"Magic Guard"!==t.ability&&(l-=Math.floor(t.maxHP/8),c.push("Bad Dreams"));var d="";i>1&&(d="approx. ",e=squashMultihit(e,i));var p=getKOChance(e,t.maxHP-s,0,1,t.maxHP,h),m=o.length>0?" after "+serializeText(o):"";if(1===p)return"guaranteed OHKO"+m;if(p>0)return d+Math.round(1e3*p)/10+"% chance to OHKO"+m;m=o.length>0||c.length>0?" after "+serializeText(o.concat(c)):"";var u;for(u=2;u<=4;u++){if(p=getKOChance(e,t.maxHP-s,l,u,t.maxHP,h),1===p)return"guaranteed "+u+"HKO"+m;if(p>0)return d+Math.round(1e3*p)/10+"% chance to "+u+"HKO"+m}for(u=5;u<=9;u++){if(predictTotal(e[0],l,u,h,t.maxHP)>=t.maxHP-s)return"guaranteed "+u+"HKO"+m;if(predictTotal(e[e.length-1],l,u,h,t.maxHP)>=t.maxHP-s)return"possible "+u+"HKO"+m}return"possibly the worst move ever"}function getKOChance(e,t,a,i,r,s){var o,n=e.length,l=e[0],c=e[n-1];if(1===i){if(c<t)return 0;for(o=0;o<n;o++)if(e[o]>=t)return(n-o)/n}if(predictTotal(c,a,i,s,r)<t)return 0;if(predictTotal(l,a,i,s,r)>=t)return 1;var h=0;s>0&&(h=Math.floor(s*r/16),s++);var d=0;for(o=0;o<n;o++){var p=getKOChance(e,t-e[o]+a-h,a,i-1,r,s);if(1===p){d+=n-o;break}d+=p}return d/n}function predictTotal(e,t,a,i,r){var s=0;if(i>0)for(var o=0;o<a-1;o++)s+=Math.floor((i+o)*r/16);var n=e*a-t*(a-1)+s;return n}function squashMultihit(e,t){if(1===e.length)return[e[0]*t];if(1===gen){for(var a=[],i=0;i<e.length;i++)a[i]=e[i]*t;return a}if(16===e.length)switch(t){case 2:return[2*e[0],e[2]+e[3],e[4]+e[4],e[4]+e[5],e[5]+e[6],e[6]+e[6],e[6]+e[7],e[7]+e[7],e[8]+e[8],e[8]+e[9],e[9]+e[9],e[9]+e[10],e[10]+e[11],e[11]+e[11],e[12]+e[13],2*e[15]];case 3:return[3*e[0],e[3]+e[3]+e[4],e[4]+e[4]+e[5],e[5]+e[5]+e[6],e[5]+e[6]+e[6],e[6]+e[6]+e[7],e[6]+e[7]+e[7],e[7]+e[7]+e[8],e[7]+e[8]+e[8],e[8]+e[8]+e[9],e[8]+e[9]+e[9],e[9]+e[9]+e[10],e[9]+e[10]+e[10],e[10]+e[11]+e[11],e[11]+e[12]+e[12],3*e[15]];case 4:return[4*e[0],4*e[4],e[4]+e[5]+e[5]+e[5],e[5]+e[5]+e[6]+e[6],4*e[6],e[6]+e[6]+e[7]+e[7],4*e[7],e[7]+e[7]+e[7]+e[8],e[7]+e[8]+e[8]+e[8],4*e[8],e[8]+e[8]+e[9]+e[9],4*e[9],e[9]+e[9]+e[10]+e[10],e[10]+e[10]+e[10]+e[11],4*e[11],4*e[15]];case 5:return[5*e[0],e[4]+e[4]+e[4]+e[5]+e[5],e[5]+e[5]+e[5]+e[5]+e[6],e[5]+e[6]+e[6]+e[6]+e[6],e[6]+e[6]+e[6]+e[6]+e[7],e[6]+e[6]+e[7]+e[7]+e[7],5*e[7],e[7]+e[7]+e[7]+e[8]+e[8],e[7]+e[7]+e[8]+e[8]+e[8],5*e[8],e[8]+e[8]+e[8]+e[9]+e[9],e[8]+e[9]+e[9]+e[9]+e[9],e[9]+e[9]+e[9]+e[9]+e[10],e[9]+e[10]+e[10]+e[10]+e[10],e[10]+e[10]+e[11]+e[11]+e[11],5*e[15]];default:return console.log("Unexpected # of hits: "+t),e}else{if(39!==e.length)return console.log("Unexpected # of possible damage values: "+e.length),e;switch(t){case 2:return[2*e[0],2*e[7],2*e[10],2*e[12],2*e[14],e[15]+e[16],2*e[17],e[18]+e[19],e[19]+e[20],2*e[21],e[22]+e[23],2*e[24],2*e[26],2*e[28],2*e[31],2*e[38]];case 3:return[3*e[0],3*e[9],3*e[12],3*e[13],3*e[15],3*e[16],3*e[17],3*e[18],3*e[20],3*e[21],3*e[22],3*e[23],3*e[25],3*e[26],3*e[29],3*e[38]];case 4:return[4*e[0],2*e[10]+2*e[11],4*e[13],4*e[14],2*e[15]+2*e[16],2*e[16]+2*e[17],2*e[17]+2*e[18],2*e[18]+2*e[19],2*e[19]+2*e[20],2*e[20]+2*e[21],2*e[21]+2*e[22],2*e[22]+2*e[23],4*e[24],4*e[25],2*e[27]+2*e[28],4*e[38]];case 5:return[5*e[0],5*e[11],5*e[13],5*e[15],5*e[16],5*e[17],5*e[18],5*e[19],5*e[19],5*e[20],5*e[21],5*e[22],5*e[23],5*e[25],5*e[27],5*e[38]];default:return console.log("Unexpected # of hits: "+t),e}}}function serializeText(e){if(0===e.length)return"";if(1===e.length)return e[0];if(2===e.length)return e[0]+" and "+e[1];for(var t="",a=0;a<e.length-1;a++)t+=e[a]+", ";return t+"and "+e[e.length-1]}function placeBsBtn(){var e="<button class='bs-btn bs-btn-default'>Import</button>";$("#import-1_wrapper").append(e),$(".bs-btn").click(function(){var e=document.getElementsByClassName("import-team-text")[0].value;addSets(e)})}function getAbility(e){return ability=e[1]?e[1].trim():"",ABILITIES_XY.indexOf(ability)!=-1?ability:void 0}function statConverter(e){switch(e){case"hp":return"hp";case"atk":return"at";case"def":return"df";case"spa":return"sa";case"spd":return"sd";case"spe":return"sp"}}function getStats(e,t,a){e.nature="Serious";var i,r,s;for(e.level=100,x=a;x<a+7;x++){var o=t[x]?t[x].split(/[\/:]/):"",n=new Object,l=new Object;switch(o[0]){case"Level":e.level=parseInt(o[1].trim());break;case"EVs":for(j=1;j<o.length;j++)i=o[j].trim().split(" "),i[1]=statConverter(i[1].toLowerCase()),n[i[1]]=parseInt(i[0]);e.evs=n;break;case"IVs":for(j=1;j<o.length;j++)r=o[j].trim().split(" "),r[1]=statConverter(r[1].toLowerCase()),l[r[1]]=parseInt(r[0]);e.ivs=l}s=t[x]?t[x].trim().split(" "):"","Nature"==s[1]&&(e.nature=s[0])}return e}function getItem(e,t){for(;t<e.length;t++){var a=e[t].trim();if(ITEMS_XY.indexOf(a)!=-1)return a}}function getMoves(e,t,a){var i=!1,r=new Array;for(x=a;x<a+12;x++)if(t[x])if("-"==t[x][0]){i=!0;var s=t[x].substr(2,t[x].length-2).replace("[","").replace("]","").replace("  ","");r.push(s)}else if(1==i)break;return e.moves=r,e}function addToDex(e){var t=new Object;void 0==SETDEX_XY[e.name]&&(SETDEX_XY[e.name]=new Object),void 0==SETDEX_BW[e.name]&&(SETDEX_BW[e.name]=new Object),void 0==SETDEX_DPP[e.name]&&(SETDEX_DPP[e.name]=new Object),void 0==SETDEX_ADV[e.name]&&(SETDEX_ADV[e.name]=new Object),void 0==SETDEX_GSC[e.name]&&(SETDEX_GSC[e.name]=new Object),void 0==SETDEX_RBY[e.name]&&(SETDEX_RBY[e.name]=new Object),void 0!==e.ability&&(t.ability=e.ability),t.level=e.level,t.evs=e.evs,t.ivs=e.ivs,t.moves=e.moves,t.nature=e.nature,t.item=e.item,localStorage.customsets?customsets=JSON.parse(localStorage.customsets):customsets={},customsets[e.name]||(customsets[e.name]={}),customsets[e.name][e.nameProp]=t,"Aegislash-Blade"==e.name&&(customsets["Aegislash-Shield"]||(customsets["Aegislash-Shield"]={}),customsets["Aegislash-Shield"][e.nameProp]=t),updateDex(customsets)}function updateDex(e){for(pokemon in e)for(moveset in e[pokemon])SETDEX_XY[pokemon]||(SETDEX_XY[pokemon]={}),SETDEX_XY[pokemon][moveset]=e[pokemon][moveset],SETDEX_BW[pokemon]||(SETDEX_BW[pokemon]={}),SETDEX_BW[pokemon][moveset]=e[pokemon][moveset],SETDEX_DPP[pokemon]||(SETDEX_DPP[pokemon]={}),SETDEX_DPP[pokemon][moveset]=e[pokemon][moveset],SETDEX_ADV[pokemon]||(SETDEX_ADV[pokemon]={}),SETDEX_ADV[pokemon][moveset]=e[pokemon][moveset],SETDEX_GSC[pokemon]||(SETDEX_GSC[pokemon]={}),SETDEX_GSC[pokemon][moveset]=e[pokemon][moveset],SETDEX_RBY[pokemon]||(SETDEX_RBY[pokemon]={}),SETDEX_RBY[pokemon][moveset]=e[pokemon][moveset];localStorage.customsets=JSON.stringify(e)}function addSets(e){var t,a,r=e.split("\n"),s=0;for(i=0;i<r.length;i++)for(t=r[i].split(/[\(\)@]/),j=0;j<t.length;j++)t[j]=checkExeptions(t[j].trim()),void 0!==POKEDEX_XY[t[j].trim()]&&(a=POKEDEX_XY[t[j].trim()],a.name=t[j].trim(),a.item=getItem(t,j+1),1===j?a.nameProp=t[j-1].trim():a.nameProp="Custom Set",a.ability=getAbility(r[i+1].split(":")),a=getStats(a,r,i+1),a=getMoves(a,r,i),addToDex(a),s++);alert("Successfully imported "+s+" sets")}function checkExeptions(e){switch(e){case"Houndoom-Mega":e="Mega Houndoom";break;case"Venusaur-Mega":e="Mega Venusaur";break;case"Blastoise-Mega":e="Mega Blastoise";break;case"Alakazam-Mega":e="Mega Alakazam";break;case"Gengar-Mega":e="Mega Gengar";break;case"Kangaskhan-Mega":e="Mega Kangaskhan";break;case"Pinsir-Mega":e="Mega Pinsir";break;case"Gyarados-Mega":e="Mega Gyarados";break;case"Aerodactyl-Mega":e="Mega Aerodactyl";break;case"Ampharos-Mega":e="Mega Ampharos";break;case"Scizor-Mega":e="Mega Scizor";break;case"Heracross-Mega":e="Mega Heracross";break;case"Tyranitar-Mega":e="Mega Tyranitar";break;case"Blaziken-Mega":e="Mega Blaziken";break;case"Gardevoir-Mega":e="Mega Gardevoir";break;case"Mawile-Mega":e="Mega Mawile";break;case"Aggron-Mega":e="Mega Aggron";break;case"Medicham-Mega":e="Mega Medicham";break;case"Manectric-Mega":e="Mega Manectric";break;case"Banette-Mega":e="Mega Banette";break;case"Absol-Mega":e="Mega Absol";break;case"Garchomp-Mega":e="Mega Garchomp";break;case"Lucario-Mega":e="Mega Lucario";break;case"Beedrill-Mega":e="Mega Beedrill";break;case"Pidgeot-Mega":e="Mega Pidgeot";break;case"Slowbro-Mega":e="Mega Slowbro";break;case"Steelix-Mega":e="Mega Steelix";break;case"Sceptile-Mega":e="Mega Sceptile";break;case"Swampert-Mega":e="Mega Swampert";break;case"Sableye-Mega":e="Mega Sableye";break;case"Sharpedo-Mega":e="Mega Sharpedo";break;case"Camerupt-Mega":e="Mega Camerupt";break;case"Altaria-Mega":e="Mega Altaria";break;case"Salamence-Mega":e="Mega Salamence";break;case"Metagross-Mega":e="Mega Metagross";break;case"Latias-Mega":e="Mega Latias";break;case"Latios-Mega":e="Mega Latios";break;case"Rayquaza-Mega":e="Mega Rayquaza";break;case"Lopunny-Mega":e="Mega Lopunny";break;case"Gallade-Mega":e="Mega Gallade";break;case"Audino-Mega":e="Mega Audino";break;case"Diancie-Mega":e="Mega Diancie";break;case"Charizard-Mega-X":e="Mega Charizard X";break;case"Charizard-Mega-Y":e="Mega Charizard Y";break;case"Mewtwo-Mega-X":e="Mega Mewtwo X";break;case"Mewtwo-Mega-Y":e="Mega Mewtwo Y";break;case"Groudon-Primal":e="Primal Groudon";break;case"Kyogre-Primal":e="Primal Kyogre";break;case"Rotom-Fan":e="Rotom-S";break;case"Rotom-Mow":e="Rotom-C";break;case"Rotom-Frost":e="Rotom-F";break;case"Rotom-Wash":e="Rotom-W";break;case"Rotom-Heat":e="Rotom-H";break;case"Meowstic-F":e="Meowstic";break;case"Kyurem-Black":e="Kyurem-B";break;case"Kyurem-White":e="Kyurem-W";break;case"Landorus-Therian":e="Landorus-T";break;case"Tornadus-Therian":e="Tornadus-T";break;case"Thundurus-Therian":e="Thundurus-T";break;case"Giratina-Origin":e="Giratina-O";break;case"Hoopa-Unbound":e="Hoopa Unbound";break;case"Gourgeist":e="Gourgeist-Average";break;case"Shaymin-Sky":e="Shaymin-S";break;case"Wormadam-Sandy":e="Wormadam-G";break;case"Wormadam-Trash":e="Wormadam-S";break;case"Deoxys-Attack":e="Deoxys-A";break;case"Deoxys-Defense":e="Deoxys-D";break;case"Deoxys-Speed":e="Deoxys-S";break;case"Aegislash":e="Aegislash-Blade";break;case"Pikachu-Belle":case"Pikachu-Cosplay":case"Pikachu-Libre":case"Pikachu-PhD":case"Pikachu-Pop-Star":case"Pikachu-Rock-Star":e="Pikachu"}return e}var bounds={level:[0,100],base:[1,255],evs:[0,252],ivs:[0,31],dvs:[0,15],"move-bp":[0,999]};for(var bounded in bounds)bounds.hasOwnProperty(bounded)&&attachValidation(bounded,bounds[bounded][0],bounds[bounded][1]);$(".level").keyup(function(){var e=$(this).closest(".poke-info");calcHP(e),calcStats(e)}),$(".nature").bind("keyup change",function(){calcStats($(this).closest(".poke-info"))}),$(".hp .base, .hp .evs, .hp .ivs").bind("keyup change",function(){calcHP($(this).closest(".poke-info"))}),$(".at .base, .at .evs, .at .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"at")}),$(".df .base, .df .evs, .df .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"df")}),$(".sa .base, .sa .evs, .sa .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"sa")}),$(".sd .base, .sd .evs, .sd .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"sd")}),$(".sp .base, .sp .evs, .sp .ivs").bind("keyup change",function(){calcStat($(this).closest(".poke-info"),"sp")}),$(".sl .base").keyup(function(){calcStat($(this).closest(".poke-info"),"sl")}),$(".at .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"at"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".df .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"df"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".sa .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"sa"),e.find(".sd .dvs").val($(this).val()),calcStat(e,"sd"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".sp .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"sp"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".sl .dvs").keyup(function(){var e=$(this).closest(".poke-info");calcStat(e,"sl"),e.find(".hp .dvs").val(getHPDVs(e)),calcHP(e)}),$(".current-hp").keyup(function(){var e=$(this).parent().children(".max-hp").text();validate($(this),0,e);var t=$(this).val();calcPercentHP($(this).parent(),e,t)}),$(".percent-hp").keyup(function(){var e=$(this).parent().children(".max-hp").text();validate($(this),0,100);var t=$(this).val();calcCurrentHP($(this).parent(),e,t)}),$(".ability").bind("keyup change",function(){$(this).closest(".poke-info").find(".move-hits").val("Skill Link"===$(this).val()?5:3)}),$("#p1 .ability").bind("keyup change",function(){autosetWeather($(this).val(),0)});var lastManualWeather="",lastAutoWeather=["",""];$("#p1 .item").bind("keyup change",function(){autosetStatus("#p1",$(this).val())});var lastManualStatus={"#p1":"Healthy"},lastAutoStatus={"#p1":"Healthy"};$(".status").bind("keyup change",function(){"Badly Poisoned"===$(this).val()?$(this).parent().children(".toxic-counter").show():$(this).parent().children(".toxic-counter").hide()}),$(".move-selector").change(function(){var e=$(this).val(),t=moves[e]||moves["(No Move)"],a=$(this).parent();a.children(".move-bp").val(t.bp),a.children(".move-type").val(t.type),a.children(".move-cat").val(t.category),a.children(".move-crit").prop("checked",t.alwaysCrit===!0),t.isMultiHit?(a.children(".move-hits").show(),a.children(".move-hits").val("Skill Link"===$(this).closest(".poke-info").find(".ability").val()?5:3)):a.children(".move-hits").hide()}),$(".set-selector").change(function(){var e,t,a=$(this).val();e=a.substring(0,a.indexOf(" (")),t=a.substring(a.indexOf("(")+1,a.lastIndexOf(")"));var i=pokedex[e];if(i){var r=$(this).closest(".poke-info");r.find(".type1").val(i.t1),r.find(".type2").val(i.t2),r.find(".hp .base").val(i.bs.hp);var s;for(s=0;s<STATS.length;s++)r.find("."+STATS[s]+" .base").val(i.bs[STATS[s]]);r.find(".weight").val(i.w),r.find(".boost").val(0),r.find(".percent-hp").val(100),r.find(".status").val("Healthy"),$(".status").change();var o,n=r.find(".ability"),l=r.find(".item");if(e in setdex&&t in setdex[e]){var c=setdex[e][t];for(r.find(".level").val(c.level),r.find(".hp .evs").val(c.evs&&"undefined"!=typeof c.evs.hp?c.evs.hp:0),r.find(".hp .ivs").val(c.ivs&&"undefined"!=typeof c.ivs.hp?c.ivs.hp:31),r.find(".hp .dvs").val(c.dvs&&"undefined"!=typeof c.dvs.hp?c.dvs.hp:15),s=0;s<STATS.length;s++)r.find("."+STATS[s]+" .evs").val(c.evs&&"undefined"!=typeof c.evs[STATS[s]]?c.evs[STATS[s]]:0),r.find("."+STATS[s]+" .ivs").val(c.ivs&&"undefined"!=typeof c.ivs[STATS[s]]?c.ivs[STATS[s]]:31),r.find("."+STATS[s]+" .dvs").val(c.dvs&&"undefined"!=typeof c.dvs[STATS[s]]?c.dvs[STATS[s]]:15);for(setSelectValueIfValid(r.find(".nature"),c.nature,"Hardy"),setSelectValueIfValid(n,i.ab?i.ab:c.ability,""),
setSelectValueIfValid(l,c.item,""),s=0;s<4;s++)o=r.find(".move"+(s+1)+" select.move-selector"),setSelectValueIfValid(o,c.moves[s],"(No Move)"),o.change()}else{for(r.find(".level").val(100),r.find(".hp .evs").val(0),r.find(".hp .ivs").val(31),r.find(".hp .dvs").val(15),s=0;s<STATS.length;s++)r.find("."+STATS[s]+" .evs").val(0),r.find("."+STATS[s]+" .ivs").val(31),r.find("."+STATS[s]+" .dvs").val(15);for(r.find(".nature").val("Hardy"),setSelectValueIfValid(n,i.ab,""),l.val(""),s=0;s<4;s++)o=r.find(".move"+(s+1)+" select.move-selector"),o.val("(No Move)"),o.change()}calcHP(r),calcStats(r),n.change(),l.change()}});var gen,genWasChanged,notation,pokedex,setdex,typeChart,moves,abilities,items,STATS,calcHP,calcStat;$(".gen").change(function(){switch(gen=~~$(this).val(),genWasChanged=!0,gen){case 1:pokedex=POKEDEX_RBY,setdex=SETDEX_RBY,typeChart=TYPE_CHART_RBY,moves=MOVES_RBY,items=[],abilities=[],STATS=STATS_RBY,calcHP=CALC_HP_RBY,calcStat=CALC_STAT_RBY;break;case 2:pokedex=POKEDEX_GSC,setdex=SETDEX_GSC,typeChart=TYPE_CHART_GSC,moves=MOVES_GSC,items=ITEMS_GSC,abilities=[],STATS=STATS_GSC,calcHP=CALC_HP_RBY,calcStat=CALC_STAT_RBY;break;case 3:pokedex=POKEDEX_ADV,setdex=SETDEX_ADV,typeChart=TYPE_CHART_GSC,moves=MOVES_ADV,items=ITEMS_ADV,abilities=ABILITIES_ADV,STATS=STATS_GSC,calcHP=CALC_HP_ADV,calcStat=CALC_STAT_ADV;break;case 4:pokedex=POKEDEX_DPP,setdex=SETDEX_DPP,typeChart=TYPE_CHART_GSC,moves=MOVES_DPP,items=ITEMS_DPP,abilities=ABILITIES_DPP,STATS=STATS_GSC,calcHP=CALC_HP_ADV,calcStat=CALC_STAT_ADV;break;case 5:pokedex=POKEDEX_BW,setdex=SETDEX_BW,typeChart=TYPE_CHART_GSC,moves=MOVES_BW,items=ITEMS_BW,abilities=ABILITIES_BW,STATS=STATS_GSC,calcHP=CALC_HP_ADV,calcStat=CALC_STAT_ADV;break;default:pokedex=POKEDEX_XY,setdex=SETDEX_XY,typeChart=TYPE_CHART_XY,moves=MOVES_XY,items=ITEMS_XY,abilities=ABILITIES_XY,STATS=STATS_GSC,calcHP=CALC_HP_ADV,calcStat=CALC_STAT_ADV}clearField(),$(".gen-specific.g"+gen).show(),$(".gen-specific").not(".g"+gen).hide();var e=getSelectOptions(Object.keys(typeChart));$("select.type1, select.move-type").find("option").remove().end().append(e),$("select.type2").find("option").remove().end().append('<option value="">(none)</option>'+e);var t=getSelectOptions(Object.keys(moves),!0);$("select.move-selector").find("option").remove().end().append(t);var a=getSelectOptions(abilities,!0);$("select.ability").find("option").remove().end().append('<option value="">(other)</option>'+a);var i=getSelectOptions(items,!0);$("select.item").find("option").remove().end().append('<option value="">(none)</option>'+i),$(".set-selector").val(getSetOptions()[gen<4?3:1].id),$(".set-selector").change()}),$(".notation").change(function(){notation=$(this).val()}),$(document).ready(function(){$("label").each(function(){$(this).removeClass("btn-xxxwide")}),$("tr").each(function(){"hp"!=$(this).attr("class")&&($(this).find("td:last-child").before('<a class="btn btn-boost">-</a>'),$(this).find("td:last-child").after('<a class="btn btn-boost">+</a>'))}),$(".panel div[class^='move'").each(function(){$(this).addClass("info-group"),$(this).addClass("move-section")}),$(".info-group .btn-boost").on("click",function(){if($(this).is(":last-child")){var e=parseInt($(this).prev().find(".boost").val());e<=5&&e>=-6&&($(this).prev().find(".boost").val(e+1),calculate())}else if($(this).is(":nth-last-child(3)")){var e=parseInt($(this).next().find(".boost").val());e<=6&&e>=-5&&($(this).next().find(".boost").val(e-1),calculate())}}),$("#gen6").prop("checked",!0),$("#gen6").change(),$("#percentage").prop("checked",!0),$("#percentage").change(),$(".set-selector").select2({formatResult:function(e){return e.set?"&nbsp;&nbsp;&nbsp;"+e.set:"<b>"+e.text+"</b>"},query:function(e){var t=30,a=_.filter(getSetOptions(),function(t){var a=t.pokemon.toUpperCase();return!e.term||0===a.indexOf(e.term.toUpperCase())||a.indexOf(" "+e.term.toUpperCase())>=0});e.callback({results:a.slice((e.page-1)*t,e.page*t),more:a.length>=e.page*t})},initSelection:function(e,t){var a=getSetOptions()[gen<4?3:1];t(a)}}),$(".move-selector").select2({dropdownAutoWidth:!0,matcher:function(e,t){return 0===t.toUpperCase().indexOf(e.toUpperCase())||t.toUpperCase().indexOf(" "+e.toUpperCase())>=0}}),$(".set-selector").val(getSetOptions()[gen<4?3:1].id),$(".set-selector").change()}),$("#p2 .ability").bind("keyup change",function(){autosetWeather($(this).val(),1)}),$("#p2 .item").bind("keyup change",function(){autosetStatus("#p2",$(this).val())}),lastManualStatus["#p2"]="Healthy",lastAutoStatus["#p1"]="Healthy";for(var resultLocations=[[],[]],i=0;i<4;i++)resultLocations[0].push({move:"#resultMoveL"+(i+1),damage:"#resultDamageL"+(i+1)}),resultLocations[1].push({move:"#resultMoveR"+(i+1),damage:"#resultDamageR"+(i+1)});var damageResults;$(".result-move").change(function(){if(damageResults){var e=findDamageResult($(this));e&&($("#mainResult").text(e.description+": "+e.damageText+" -- "+e.koChanceText),$("#damageValues").text("("+e.damage.join(", ")+")"))}});var calculateAllMoves;$(".gen").change(function(){switch(gen){case 1:calculateAllMoves=CALCULATE_ALL_MOVES_RBY;break;case 2:calculateAllMoves=CALCULATE_ALL_MOVES_GSC;break;case 3:calculateAllMoves=CALCULATE_ALL_MOVES_ADV;break;case 4:calculateAllMoves=CALCULATE_ALL_MOVES_DPP;break;default:calculateAllMoves=CALCULATE_ALL_MOVES_BW}}),$(".mode").change(function(){window.location.replace("calc_bc.html?mode="+$(this).attr("id"))}),$(".notation").change(function(){calculate()}),$(document).ready(function(){$(".terrain-trigger").bind("change keyup",getTerrainEffects),$(".calc-trigger").bind("change keyup",function(){setTimeout(calculate,0)}),calculate()}),$(document).ready(function(){placeBsBtn(),localStorage.customsets&&updateDex(JSON.parse(localStorage.customsets))});